(function(g,b,o,x,u,d,m){"use strict";const{ScrollView:v,Text:I,View:D,TextInput:w,Button:h}=b.General,{FormRow:B,FormIcon:p,FormDivider:y,FormSwitchRow:R}=b.Forms,G=d.findByName("RowManager"),C=(r)=>r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),f=()=>JSON.parse(o.storage.rules||"[]").map(r=>{try{return{re:new RegExp(r.regex?r.find:C(r.find),r.ci?"gi":"g"),to:r.replace}}catch{return null}}).filter(Boolean);o.storage.rules??=JSON.stringify([{name:"Example Rule",find:"old",replace:"new",regex:!1,ci:!1}]),o.storage.enabled??=!0,o.storage.showEditor??=!1;let s=[];const N=function(){const r=d.findByName("UserProfilePrimaryInfo",!1),l=d.findByName("UserProfileAboutMeCard",!1),E=d.findByName("ChatViewWrapperBase",!1);s.push(m.before("generate",G.prototype,function(c){let[e]=c;try{const a=f();for(const t of a)e?.message?.content&&(e.message.content=e.message.content.replace(t.re,t.to)),e?.message?.author?.avatarDecorationData?.asset&&(e.message.author.avatarDecorationData.asset=e.message.author.avatarDecorationData.asset.replace(t.re,t.to)),e?.message?.author?.primaryGuild?.tag&&(e.message.author.primaryGuild.tag=e.message.author.primaryGuild.tag.replace(t.re,t.to)),e?.message?.author?.primaryGuild?.badge&&(e.message.author.primaryGuild.badge=e.message.author.primaryGuild.badge.replace(t.re,t.to)),e?.message?.author?.primaryGuild?.identityGuildId&&(e.message.author.primaryGuild.identityGuildId=e.message.author.primaryGuild.identityGuildId.replace(t.re,t.to)),e?.message?.author?.username&&(e.message.author.username=e.message.author.username.replace(t.re,t.to))}catch{}})),s.push(m.after("default",r,function(c,e){try{const a=f();for(const t of a)e?.props?.children[1]?.props?.children[0]?.props?.userTag&&(e.props.children[1].props.children[0].props.userTag=e.props.children[1].props.children[0].props.userTag.replace(t.re,t.to))}catch{}})),s.push(m.after("default",l,function(c,e){try{const a=f();for(const t of a)e?.props?.children[1]?.props?.userId&&(e.props.children[1].props.userId=e.props.children[1].props.userId.replace(t.re,t.to))}catch{}})),s.push(m.after("default",E,function(c,e){try{const a=f();for(const t of a){const n=e.props.children.props.children.filter(i=>Boolean(i))[0].props.children.props.channel.recipients;n.forEach((i,_)=>{n[_]=i.replace(t.re,t.to)})}}catch{}}))},T=function(){const r=JSON.parse(o.storage.rules||"[]"),l=a=>o.storage.rules=JSON.stringify(a),E=()=>l([...r,{name:"",find:"",replace:"",regex:!1,ci:!1}]),c=a=>l(r.filter((t,n)=>n!==a)),e=(a,t)=>l(r.map((n,i)=>i===a?{...n,...t}:n));return React.createElement(v,{style:{paddingBottom:100}},React.createElement(I,{style:{margin:12,fontSize:16,fontWeight:"bold"}},"Replacement Rules"),r.map(function(a,t){return React.createElement(D,{key:t,style:{margin:8,padding:8,borderWidth:1,borderColor:"#666",borderRadius:6}},React.createElement(w,{placeholder:"Rule name (description)",value:a.name,onChangeText:n=>e(t,{name:n}),style:{borderWidth:1,borderColor:"#888",padding:6,marginBottom:6,color:"#fff"}}),React.createElement(w,{placeholder:"Text to find",value:a.find,onChangeText:n=>e(t,{find:n}),style:{borderWidth:1,borderColor:"#888",padding:6,marginBottom:6,color:"#fff"}}),React.createElement(w,{placeholder:"Replace with",value:a.replace,onChangeText:n=>e(t,{replace:n}),style:{borderWidth:1,borderColor:"#888",padding:6,marginBottom:6,color:"#fff"}}),React.createElement(R,{label:"Case-insensitive",leading:React.createElement(p,{source:u.getAssetIDByName("ic_visibility_24px")}),value:a.ci,onValueChange:n=>e(t,{ci:n})}),React.createElement(R,{label:"Regular expression",leading:React.createElement(p,{source:u.getAssetIDByName("ic_search_24px")}),value:a.regex,onValueChange:n=>e(t,{regex:n})}),React.createElement(h,{title:"Delete rule",onPress:()=>c(t),color:"red"}),React.createElement(y,null))}),React.createElement(h,{title:"Add rule",onPress:E}))};var P={settings:function(){return x.useProxy(o.storage),React.createElement(v,null,React.createElement(R,{label:"Enable replacements",leading:React.createElement(p,{source:u.getAssetIDByName("ic_message_edit")}),value:o.storage.enabled,onValueChange:r=>o.storage.enabled=r}),React.createElement(y,null),React.createElement(B,{label:"Manage rules",subLabel:"Add, edit or delete replacement strings",leading:React.createElement(p,{source:u.getAssetIDByName("ic_settings_24px")}),trailing:B.Arrow,onPress:()=>o.storage.showEditor=!o.storage.showEditor}),o.storage.showEditor&&React.createElement(React.Fragment,null,React.createElement(y,null),React.createElement(T,null),React.createElement(h,{title:"Close editor",onPress:()=>o.storage.showEditor=!1})))},"onLoad"(){console.log("[TR] onLoad start"),setTimeout(()=>N(),0)},"onUnload"(){console.log("[TR] onUnload"),s.forEach(r=>r?.())}};return g.default=P,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.ui.components,vendetta.plugin,vendetta.storage,vendetta.ui.assets,vendetta.metro,vendetta.patcher);
